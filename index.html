<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
<title>ImageManager test</title>
	<script src="imanager.js" type="text/javascript"></script>
    <script src="timer.js" type="text/javascript"></script>
</head>
<body onload = "OnLoad()">
	<canvas id="content" width="500" height="500"></canvas>

<script>
	function OnLoad()
	{
        var dx = 5;
        var dy = 5;
        var x = 150;
        var y = 100;
        var HEIGHT = 500;
        var WIDTH = 500;
        var mouseX = 0;
        var mouseY = 0;


        window.addEventListener('keydown',doKeyDown,true);

		var canvas = document.getElementById("content");
        canvas.onmousemove = mouseMove;
		var ctx = canvas.getContext('2d');

		var load_list = ["r/ball.png"];
		var loader = ImageManager(load_list, null, on_progress);

        var frame_timer = new FrameTimer();
        frame_timer.tick();

        function mouseMove(event) {
                x = event.clientX - canvas.offsetLeft;
                y = event.clientY - canvas.offsetTop;
            }

        function doKeyDown(evt) {
            switch (evt.keyCode) {
                case 37:  /* Left arrow was pressed */
                    if (x - dx > 0) {
                        x -= dx;
                    }
                    break;
                case 39:  /* Right arrow was pressed */
                    if (x + dx < WIDTH) {
                        x += dx;
                    }
                    break;
            }
        }

		function on_progress(current, total, image)
		{
            var interval = 1    ;
			setInterval(function(){
                    ctx.clearRect(0, 0, 500, 500);
                    ctx.drawImage(image, x, 400);
                    interval = frame_timer.getSeconds();
                    frame_timer.tick();
                }, 5);
		}	
	}
</script>
</body>
</html>